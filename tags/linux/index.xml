<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Linux on luoboQAQ</title><link>https://lbqaq.top/tags/linux/</link><description>Recent content in Linux on luoboQAQ</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 05 Jul 2023 20:58:15 +0800</lastBuildDate><atom:link href="https://lbqaq.top/tags/linux/index.xml" rel="self" type="application/rss+xml"/><item><title>fontconfig：Linux下的字体配置</title><link>https://lbqaq.top/p/linux-font/</link><pubDate>Wed, 05 Jul 2023 20:58:15 +0800</pubDate><guid>https://lbqaq.top/p/linux-font/</guid><description>&lt;img src="https://lbqaq.top/p/linux-font/109572761.webp" alt="Featured image of post fontconfig：Linux下的字体配置" />&lt;h2 id="字体的分类">&lt;a href="#%e5%ad%97%e4%bd%93%e7%9a%84%e5%88%86%e7%b1%bb" class="header-anchor">&lt;/a>字体的分类
&lt;/h2>&lt;p>字体的数量可以说是成千上万，但一般在电脑上显示的基本为以下这三类&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>monospace [等宽]&lt;/p>
&lt;p>等宽字体是指字符宽度相同的字体，用于需要字符严格对齐的场合，例如控制台和源代码。与此相对，字符宽度各不相同的字体称为比例字体(其余四类字体都是)。不过，对于中文字体而言，并不存在等宽与比例的差别，因为所有中文字都是等宽的。中文字体中的“等宽”指的是字体的西文部分是等宽的，2个字母对应1个汉字。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>sans-serif [无衬线]&lt;/p>
&lt;p>是指笔画末端没有修饰(衬线)的字体，通常用于屏幕显示。中文的黑体与圆体就属于此类字体。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>serif [有衬线]&lt;/p>
&lt;p>是指笔画末端有修饰(衬线)的字体，通常用于打印。中文的宋体与仿宋就属于此类字体。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>我们要做的字体配置主要就是针对上面这三类字体。&lt;/p>
&lt;h2 id="选字体">&lt;a href="#%e9%80%89%e5%ad%97%e4%bd%93" class="header-anchor">&lt;/a>选字体
&lt;/h2>&lt;p>有了目标，下面就是选一个自己喜欢的字体了。不过，对于中文字体，目前现在 Linux 上常用的、在维护的开源中文字体就一套——“思源黑体”和“思源宋体”，同时被 &lt;a class="link" href="https://en.wikipedia.org/wiki/Noto_fonts" target="_blank" rel="noopener"
>Noto&lt;/a> 和&lt;a class="link" href="https://en.wikipedia.org/wiki/Source_Han_Sans" target="_blank" rel="noopener"
>思源&lt;/a>两个项目收录。Noto 系列字体是 Google 主导的，思源系列字体是 Adobe 主导的。&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>&lt;/p>
&lt;p>对于编程字体，可以选择的余地就多多了，像是Source Code Pro，Consolas，Menlo等等。我一开始选择的是 &lt;a class="link" href="https://github.com/be5invis/Iosevka" target="_blank" rel="noopener"
>Iosevka&lt;/a> 。但是，这款字体给我感觉太瘦了，看起来很是别扭。最后，我选择了广受好评的 &lt;a class="link" href="https://github.com/tonsky/FiraCode" target="_blank" rel="noopener"
>Fira Code&lt;/a> 。&lt;/p>
&lt;p>小结一下，我的选择是：&lt;/p>
&lt;ul>
&lt;li>无衬线：西文 Noto Sans，中文 Noto Sans CJK&lt;/li>
&lt;li>衬线：西文 Noto Serif，中文 Noto Serif CJK&lt;/li>
&lt;li>等宽：西文 Fira Code，中文 Noto Sans Mono CJK&lt;/li>
&lt;/ul>
&lt;p>在ArchLiunx上，我们只需要安装&lt;code>noto-fonts&lt;/code>和&lt;code>noto-fonts-cjk&lt;/code>这两个包即可，他们分别提供了西文字体 Noto Sans / Noto Serif和中文字体 Noto Sans CJK / Noto Serif CJK / Noto Sans Mono CJK 。&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup>&lt;/p>
&lt;p>关于 emoji，我选择了 Twitter 推出的字体 Twemoji。&lt;/p>
&lt;ul>
&lt;li>ttf-twemoji&lt;/li>
&lt;/ul>
&lt;p>另外，少不了人见人爱的图标字体 Nerd Fonts。&lt;/p>
&lt;ul>
&lt;li>ttf-nerd-fonts-symbols&lt;/li>
&lt;/ul>
&lt;p>这里就有小伙伴开始好奇了，如何让西文和中文使用不同的字体呢？&lt;/p>
&lt;p>在 Windows 下，我们可以选择合成字体，即将各类字体打包到一起。例如&lt;a class="link" href="https://github.com/be5invis/Sarasa-Gothic" target="_blank" rel="noopener"
>更纱黑体&lt;/a>就是由思源黑体和西文字体 Iosevka 整合而来的。这种字体的好处就是方便，直接选择使用即可。但是缺点也是显而易见，就是打包太麻烦了，引入 Iosevka 要打一次包，想要支持 Nerd Fonts，又要打一次包。如果是别人帮你提供好的合成字体那还好说， 从网上下载、从软件仓库安装就完事了，自己打包的话真的工作量巨大。&lt;/p>
&lt;p>而在 Liunx 下，我们只需要配置 fontconfig 就好了，无论想怎么搭配都可以实现，听起来是不是特别酷😎。可惜的是，有一些程序对 fontconfig 支持并不完善，这就达不到我们想要的效果。（说的就是你，Chrome😠）&lt;/p>
&lt;h2 id="fontconfig">&lt;a href="#fontconfig" class="header-anchor">&lt;/a>fontconfig
&lt;/h2>&lt;p>在我们开始正式配置前，还是有必要了解一些基本的知识。这里我就简单介绍一下，如果想要深入了解的话可以看看双猫大佬的&lt;a class="link" href="https://catcat.cc/post/2020-10-31/" target="_blank" rel="noopener"
>这篇文章&lt;/a>，里面详细介绍了Linux fontconfig 的字体匹配机制。&lt;/p>
&lt;h3 id="字体的属性">&lt;a href="#%e5%ad%97%e4%bd%93%e7%9a%84%e5%b1%9e%e6%80%a7" class="header-anchor">&lt;/a>字体的属性
&lt;/h3>&lt;p>字体有很多属性，常用的有字族（family）、倾斜（slant）、字重（weight）。后两者合一起叫样式（style）。&lt;/p>
&lt;p>字族就是它的名字啦。一个字体文件，可以提供多个字体族名 (family)。比如 Arch Linux 用户在安装 wqy-microhei 后，系统端增加了 wqy-microhei.ttc 这个字体文件，分别提供「WenQuanYi Micro Hei」「文泉驛微米黑」,「文泉驿微米黑」三个字体族名，它们是一个意思。我们可以运行 fontconfig 提供的命令行工具 fc-list 去查看系统上已安装的字体已经它们对应的字体族名。&lt;/p>
&lt;p>倾斜就是斜不斜，英文叫「Roman」「Italic」或者「Oblique」，Italic 是专门的斜体写法（更接近手写样式）， Oblique 是把常规写法倾斜一下完事。&lt;/p>
&lt;p>字重就更简单了，就是笔划的粗细。常见的有 Regular、Normal、Medium、Bold、Semibold、Black、Thin、Light、Extralight 等。&lt;/p>
&lt;h3 id="通用字族名">&lt;a href="#%e9%80%9a%e7%94%a8%e5%ad%97%e6%97%8f%e5%90%8d" class="header-anchor">&lt;/a>通用字族名
&lt;/h3>&lt;p>很多时候，程序并不在乎用户具体使用的是哪款字体，像很多网站的 CSS 那样把各个平台的常见字体全部列出来太傻了，又容易出问题。所以，人们发明了「通用字族名」，也就是 sans-serif (sans)、serif 和 monospace (mono) 这些。它们不是真实存在的字体，而是分别指示程序去使用无衬线、衬线、等宽字体。那么桌面程序又是如何知道具体使用哪些字体呢？它只需要去查询 fontconfig 就行了。由于它们必定要经过 fontconfig 的查询流程后才能使用字体，所以我们可以通过 fontconfig 的配置去精准控制程序使用的字体。&lt;/p>
&lt;h3 id="如何调试">&lt;a href="#%e5%a6%82%e4%bd%95%e8%b0%83%e8%af%95" class="header-anchor">&lt;/a>如何调试
&lt;/h3>&lt;p>传入环境变量&lt;code>FC_DEBUG=4&lt;/code>即可，例如：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">FC_DEBUG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> kitty
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>fontconfig 就会打印调试信息，其中可以看到：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">FcConfigSubstitute Pattern has 6 elts (size 16)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> family: &amp;#34;monospace&amp;#34;(s)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slant: 0(i)(s)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> weight: 80(i)(s)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pixelsize: 19.1667(f)(s)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lang: &amp;#34;en&amp;#34;(w)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prgname: &amp;#34;kitty&amp;#34;(s)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>除了启动一个程序来看它字体的调用日志，我们也可以手动调用。例如，我想看 monospace 在系统里被修改成了什么字体，就可以执行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">FC_DEBUG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> fc-match &lt;span class="s1">&amp;#39;monospace&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>打印出的调试信息会很长，我们主要看几个部分：&lt;/p>
&lt;p>第一部分，Add Rule，指已添加的配置文件规则。这里面也包含了家目录下的配置文件，可以找来看看被解析成了什么。&lt;/p>
&lt;p>第二部分，在 Add Rule 之后，迎来了最关键的、我们应当关心的 FcConfigSubstitute Pattern，它包含了 font pattern。(s) 和 (w) 分别代表强弱绑定；prgname 代表程序名，此时就是 fc-match。至于 lang，由于没有对 fc-match 指定语言，所以默认是 en。&lt;/p>
&lt;p>接下来有很多条 FcConfigSubstitute editPattern，代表对 font pattern 的替换操作。但是必须当规则匹配的时候，也就是 Rule Set 不是 No match 的情况下，才执行 FcConfigSubstitute editPattern。那么，又应该怎么看 FcConfigSubstitute editPattern 呢？主要看 family，因为 family 代表着字体匹配顺序。它就是配置文件中的&lt;code>&amp;lt;edit target=&amp;quot;pattern&amp;quot;&amp;gt;&lt;/code>操作。&lt;/p>
&lt;p>最后应该关心 FcConfigSubstitute donePattern，这是 fontconfig 执行完字体替换后的结果。&lt;/p>
&lt;h3 id="配置文件">&lt;a href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" class="header-anchor">&lt;/a>配置文件
&lt;/h3>&lt;p>整个配置文件由如下几个部分依次拼接而成：&lt;/p>
&lt;ol>
&lt;li>目录设置(&lt;code>&amp;lt;dir&amp;gt;&lt;/code>, &lt;code>&amp;lt;cachedir&amp;gt;&lt;/code>, &lt;code>&amp;lt;include&amp;gt;&lt;/code>)&lt;/li>
&lt;li>杂项设置(&lt;code>&amp;lt;config&amp;gt;&lt;/code>)&lt;/li>
&lt;li>扫描阶段(&lt;code>&amp;lt;match target=&amp;quot;scan&amp;quot;&amp;gt;&lt;/code>)&lt;/li>
&lt;li>匹配阶段(&lt;code>&amp;lt;alias&amp;gt;&lt;/code>, &lt;code>&amp;lt;match target=&amp;quot;pattern&amp;quot;&amp;gt;&lt;/code>)&lt;/li>
&lt;li>渲染阶段(&lt;code>&amp;lt;match target=&amp;quot;font&amp;quot;&amp;gt;&lt;/code>)&lt;/li>
&lt;/ol>
&lt;p>想要实现合成字体的效果，一个最简单的思路，本文也基于该思路：不让程序使用某个具体的字体，而是使用通用字体族名 (Generic Font Family)。比如，让程序使用 sans-serif，也就是默认的无衬线字体。&lt;/p>
&lt;p>我们要关心第四个部分，即匹配阶段，使用 fontconfig 配置如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>sans-serif&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;prepend&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans CJK SC&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Twemoji&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这种 font stack 的方式，即可让程序按照以下顺序渲染字体：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Noto Sans CJK SC —&amp;gt; Noto Sans -&amp;gt; Twemoji
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里的&lt;code>&amp;lt;test&amp;gt;&lt;/code>就是条件判断，&lt;code>mode=&amp;quot;prepend&amp;quot;&lt;/code>指在前添加，&lt;code>binding=&amp;quot;strong&amp;quot;&lt;/code>则是强绑定&lt;/p>
&lt;h2 id="开始配置">&lt;a href="#%e5%bc%80%e5%a7%8b%e9%85%8d%e7%bd%ae" class="header-anchor">&lt;/a>开始配置
&lt;/h2>&lt;p>我们的思路就是就是修改默认的字族，让其成为我们想要指定的字体。然后将所有程序的字体配置改为通用字体族名：sans-serif，serif，monospace。&lt;/p>
&lt;p>我们的配置都放在此目录中&lt;code>~/.config/fontconfig/fonts.conf&lt;/code>，我的完整配置在&lt;a class="link" href="https://github.com/luoboQAQ/dotconfig/tree/main/fontconfig" target="_blank" rel="noopener"
>此仓库&lt;/a>中。&lt;/p>
&lt;h3 id="设置默认字体">&lt;a href="#%e8%ae%be%e7%bd%ae%e9%bb%98%e8%ae%a4%e5%ad%97%e4%bd%93" class="header-anchor">&lt;/a>设置默认字体
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- Default system-ui fonts --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>system-ui&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;prepend&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>sans-serif&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- Default sans-serif fonts--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>sans-serif&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;prepend&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans CJK SC&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Twemoji&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- Default serif fonts--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>serif&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;prepend&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Serif CJK SC&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Serif&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Twemoji&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- Default monospace fonts--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>monospace&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;prepend&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans Mono CJK SC&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Symbols Nerd Font&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Twemoji&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">compare=&lt;/span>&lt;span class="s">&amp;#34;contains&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Source Code&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Fira Code&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>对 system-ui，sans-serif，serif，monospace 设置优先显示的字体。在这里我让 system-ui 默认为无衬线。注意，system-ui 必须在最前。由于 fontconfig 对 font pattern 的操作是按顺序执行的，所以必须先让 system-ui 能优先以 sans-serif 显示，然后才是对 sans-serif 的操作。&lt;/p>
&lt;p>所有的 Noto CJK 字体都以 SC 结尾，因为我希望在没指定语言的默认情况下，以简体中文显示中文字形。&lt;/p>
&lt;h3 id="设置异形字">&lt;a href="#%e8%ae%be%e7%bd%ae%e5%bc%82%e5%bd%a2%e5%ad%97" class="header-anchor">&lt;/a>设置异形字
&lt;/h3>&lt;p>什么是异形字？Noto Sans CJK 中的异体字，是在 &lt;strong>相同的&lt;/strong> Unicode 码位下，不同的语言会使用不同的字形。&lt;/p>
&lt;p>可以在双猫大佬的&lt;a class="link" href="https://catcat.cc/raw/fontconfig.html#%E5%BC%82%E4%BD%93%E5%AD%97" target="_blank" rel="noopener"
>这个测试网站&lt;/a>中看到，不同的语言环境下，这些字的显示是不同的。&lt;/p>
&lt;p>&lt;img src="https://lbqaq.top/p/linux-font/IMAGE/font_glyph_variants.png"
width="250"
height="280"
srcset="https://lbqaq.top/p/linux-font/IMAGE/font_glyph_variants_hu_748a2ef604a61235.png 480w, https://lbqaq.top/p/linux-font/IMAGE/font_glyph_variants_hu_92a7f637e7b2aeb8.png 1024w"
loading="lazy"
alt="异形字"
class="gallery-image"
data-flex-grow="89"
data-flex-basis="214px"
>&lt;/p>
&lt;p>我们想要实现在保留异体字的情况下，让它默认显示中国大陆字形；只在特定语言下显示异体字，比如用浏览器查看一个日文页面。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">&amp;lt;!-- Replace fonts for Japanese --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;lang&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>ja&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans CJK SC&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans CJK JP&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在字体匹配时，将 Noto Sans CJK SC 替换成 Noto Sans CJK JP。除了 ，你还需要照葫芦画瓢分别指定 zh-TW、zh-HK、ja、ko，以及对宋体和等宽字体进行重复的步骤。在此我就不重复了。&lt;/p>
&lt;h3 id="解决全角引号">&lt;a href="#%e8%a7%a3%e5%86%b3%e5%85%a8%e8%a7%92%e5%bc%95%e5%8f%b7" class="header-anchor">&lt;/a>解决全角引号
&lt;/h3>&lt;p>英文中的单引号有两种，&lt;code>'&lt;/code>(U+0027) 和&lt;code>’&lt;/code>(U+2019)。可能会觉得前一种出现在英文文本中，后一种出现在中文文本中，并且宽度和中文等宽。然而，英语世界中的一些人在英文文章中也是会使用后一种的。所以，字体在显示后一种引号的时候，究竟是和英文字母一样窄，还是该和中文字体等宽呢？如果在英文文章中显示成全宽字符则会显得突兀。&lt;/p>
&lt;p>比如，思源黑体其实也包含了拉丁字母的字形，可以完全使用思源黑体去显示西文。此时，后一种单引号的宽度会显示成中文字形的宽度。导致即使在全英文环境中，单引号也会突兀地在文本中过宽。&lt;/p>
&lt;p>同样地，&lt;code>‘&lt;/code>(U+2018) &lt;code>“&lt;/code>(U+201C) &lt;code>”&lt;/code>(U+201D) 也有类似的情况。&lt;/p>
&lt;p>我们的目标是在不同语言环境下字形会有所区别，让引号只在中文文本中全宽。&lt;/p>
&lt;p>同样，在双猫大佬的&lt;a class="link" href="https://catcat.cc/raw/fontconfig.html#%E5%BC%82%E4%BD%93%E5%AD%97" target="_blank" rel="noopener"
>这个测试网站&lt;/a>中可以进行测试：&lt;/p>
&lt;p>&lt;img src="https://lbqaq.top/p/linux-font/IMAGE/font_quote.png"
width="280"
height="85"
srcset="https://lbqaq.top/p/linux-font/IMAGE/font_quote_hu_c4b7d90fcc11c9b2.png 480w, https://lbqaq.top/p/linux-font/IMAGE/font_quote_hu_4db44c4d82d44826.png 1024w"
loading="lazy"
alt="全角引号"
class="gallery-image"
data-flex-grow="329"
data-flex-basis="790px"
>&lt;/p>
&lt;p>利用fontconfig，可以方便的解决此问题&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">&amp;lt;!-- 解决全角引号 --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;lang&amp;#34;&lt;/span> &lt;span class="na">compare=&lt;/span>&lt;span class="s">&amp;#34;contains&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>en&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">compare=&lt;/span>&lt;span class="s">&amp;#34;contains&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans CJK&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;prepend&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="覆盖西文字体">&lt;a href="#%e8%a6%86%e7%9b%96%e8%a5%bf%e6%96%87%e5%ad%97%e4%bd%93" class="header-anchor">&lt;/a>覆盖西文字体
&lt;/h3>&lt;p>如果去观察 Noto Sans CJK 这个中文字体，会发现它的西文部分的字形其实和 Noto Sans 不一样，虽然它们都以 Noto 自称。中文字体携带的英文字符有可能十分糟糕，特别是 Windows 自带的 SimHei，也就是中易黑体，它的英文相当糟糕。另外，微软雅黑的字重实在是太少了，对于设计师来说很不友好。而各种流行的英文字体支持很多字重。&lt;/p>
&lt;p>Noto Sans CJK 的英文还是比较不错的，为了字体的样式统一，这里就不修改sans-serif和seri了。主要将编程用的等宽字体换成Fira Code。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">&amp;lt;!-- Replace english fonts--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;prgname&amp;#34;&lt;/span> &lt;span class="na">compare=&lt;/span>&lt;span class="s">&amp;#34;not_eq&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>msedge&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">compare=&lt;/span>&lt;span class="s">&amp;#34;contains&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans Mono CJK&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;prepend&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Fira Code&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里为什么要多加一句判断呢？这是因为有些程序居然只使用 font pattern 结果中的首个字体，比如 Chrome（以及衍生的Chromium），虽然 Chrome 接受了我们指定的西文字体，但是它忽略了紧接其后的中文字体，即使配置采用了强绑定！然后中文字体又不知道它 fallback 到哪去了，可能会出现你想要的中文字体，也可能不是。&lt;/p>
&lt;p>这里是 msedge 主要是我平时都用 edge 而不是 Chrome。可惜由于 Chromium 在 Linux 上小问题实在是太多了，还是老老实实的用 firefox 吧。&lt;/p>
&lt;p>在所有情况下，除了程序名为 msedge 的情况下，优先使用 Fira Code 显示西文，再用 Noto Sans Mono CJK 显示中文。虽然我不能让 msedge 使用 Fira Code，但它一定能用上 Noto Sans Mono CJK 显示中文。&lt;/p>
&lt;h3 id="替换任意字体">&lt;a href="#%e6%9b%bf%e6%8d%a2%e4%bb%bb%e6%84%8f%e5%ad%97%e4%bd%93" class="header-anchor">&lt;/a>替换任意字体
&lt;/h3>&lt;p>当系统里已经安装了一些不需要的字体，但又不想删除或者屏蔽它怎么办呢？替换掉 font pattern 就可以了。&lt;/p>
&lt;p>我这里则是用来替换思源字体，毕竟它就是 Noto 嘛&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">qual=&lt;/span>&lt;span class="s">&amp;#34;any&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Source Han Sans&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;assign&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;same&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans CJK SC&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="字体渲染参数">&lt;a href="#%e5%ad%97%e4%bd%93%e6%b8%b2%e6%9f%93%e5%8f%82%e6%95%b0" class="header-anchor">&lt;/a>字体渲染参数
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">&amp;lt;!--rendering options--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;font&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;autohint&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;assign&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;bool&amp;gt;&lt;/span>false&lt;span class="nt">&amp;lt;/bool&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;hinting&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;assign&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;bool&amp;gt;&lt;/span>true&lt;span class="nt">&amp;lt;/bool&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;hintstyle&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;assign&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;const&amp;gt;&lt;/span>hintslight&lt;span class="nt">&amp;lt;/const&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;antialias&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;assign&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;bool&amp;gt;&lt;/span>true&lt;span class="nt">&amp;lt;/bool&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;lcdfilter&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;assign&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;const&amp;gt;&lt;/span>lcddefault&lt;span class="nt">&amp;lt;/const&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;rgba&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;assign&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;const&amp;gt;&lt;/span>rgb&lt;span class="nt">&amp;lt;/const&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里主要设置了一些字体的渲染方式：&lt;/p>
&lt;ul>
&lt;li>&lt;code>autohint&lt;/code>：优先使用内嵌微调&lt;/li>
&lt;li>&lt;code>hinting&lt;/code>：开启微调&lt;/li>
&lt;li>&lt;code>hintstyle&lt;/code>：微调的程度，轻微&lt;/li>
&lt;li>&lt;code>antialias&lt;/code>：开启抗锯齿功能&lt;/li>
&lt;li>&lt;code>lcdfilter&lt;/code>：LCD filter 的风格，默认&lt;/li>
&lt;li>&lt;code>rgba&lt;/code>：LCD 子像素的排列顺序，rgb&lt;/li>
&lt;/ul>
&lt;p>这里就直接抄作业了。&lt;/p>
&lt;h2 id="遇到的问题">&lt;a href="#%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98" class="header-anchor">&lt;/a>遇到的问题
&lt;/h2>&lt;h3 id="全角引号设置无效">&lt;a href="#%e5%85%a8%e8%a7%92%e5%bc%95%e5%8f%b7%e8%ae%be%e7%bd%ae%e6%97%a0%e6%95%88" class="header-anchor">&lt;/a>全角引号设置无效
&lt;/h3>&lt;p>一开始我遇到了这个问题，无论怎么设置都是半角，经过排查以及网友的留言后发现，这是由于系统变量中的&lt;code>LANG&lt;/code>为&lt;code>en_US.utf-8&lt;/code>，这会导致传递给 fontconfig 的 lang 是 &lt;code>lang: zh-cn(s) &amp;quot;en&amp;quot;(w)&lt;/code>。于是就一直匹配西文字体。&lt;/p>
&lt;p>解决办法有两个，一个是直接修改&lt;code>LANG&lt;/code>环境变量为&lt;code>zh_CN.UTF-8&lt;/code>，我目前采用的就是这种形式。&lt;/p>
&lt;p>或者就是默认渲染英文，当网页声明是中文时再换字体，相关配置如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">&amp;lt;!-- Default sans-serif fonts--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>sans-serif&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;prepend&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans CJK SC&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Color Emoji&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&amp;lt;!-- cn --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;match&lt;/span> &lt;span class="na">target=&lt;/span>&lt;span class="s">&amp;#34;pattern&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;lang&amp;#34;&lt;/span> &lt;span class="na">compare=&lt;/span>&lt;span class="s">&amp;#34;contains&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>cn&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;test&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">compare=&lt;/span>&lt;span class="s">&amp;#34;contains&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/test&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;edit&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;family&amp;#34;&lt;/span> &lt;span class="na">mode=&lt;/span>&lt;span class="s">&amp;#34;prepend&amp;#34;&lt;/span> &lt;span class="na">binding=&lt;/span>&lt;span class="s">&amp;#34;strong&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>Noto Sans CJK SC&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/edit&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/match&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样如果网页声明了&lt;code>lang=zh-cn&lt;/code>，就会用&lt;code>Noto Sans CJK SC&lt;/code>字体进行覆盖，也就实现了全宽引号。假如网页没有声明&lt;code>lang&lt;/code>或者错误地声明了&lt;code>lang=en&lt;/code>，这时就会出现半角引号+汉字的组合了。&lt;/p>
&lt;h2 id="不能解决的问题">&lt;a href="#%e4%b8%8d%e8%83%bd%e8%a7%a3%e5%86%b3%e7%9a%84%e9%97%ae%e9%a2%98" class="header-anchor">&lt;/a>不能解决的问题
&lt;/h2>&lt;p>Linux 不强迫程序必须使用特定的依赖，而是程序主动选择了约定俗成的依赖。老话重谈，程序可以自由选择完全遵守 fontconfig，也可以选择部分使用 fontconfig 的配置，或者完全不遵守它。这也导致了对一些程序无法实现字体的修改。以及上面提到的 chrome 对 fontconfig 并不是很好，或许面对这种程序，就需要合成字体的出场了。&lt;/p>
&lt;h2 id="参考文献">&lt;a href="#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae" class="header-anchor">&lt;/a>参考文献
&lt;/h2>&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;a class="link" href="http://www.jinbuguo.com/gui/linux_fontconfig.html" target="_blank" rel="noopener"
>Linux字体美化实战(Fontconfig配置) [金步国]&lt;/a>&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>&lt;a class="link" href="https://blog.lilydjwg.me/2023/3/5/linux-fonts.216591.html" target="_blank" rel="noopener"
>Linux 上的字体配置与故障排除 - 依云&amp;rsquo;s Blog&lt;/a>&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>&lt;a class="link" href="https://catcat.cc/post/2021-03-07/" target="_blank" rel="noopener"
>用 fontconfig 治理 Linux 中的字体 - 双猫CC&lt;/a>&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>ReDroid+MAA：在Linux下游玩明日方舟</title><link>https://lbqaq.top/p/redroid-maa/</link><pubDate>Sat, 17 Jun 2023 16:47:00 +0800</pubDate><guid>https://lbqaq.top/p/redroid-maa/</guid><description>&lt;img src="https://lbqaq.top/p/redroid-maa/103123878.webp" alt="Featured image of post ReDroid+MAA：在Linux下游玩明日方舟" />&lt;p>最近打算将ArchLinux作为主力系统挑战一下，由于平时有用电脑挂明日方舟的习惯，于是打算安装模拟器在Linux上。相较于Windows下各种xx模拟器百花齐放，Linux下就惨不忍睹了。网上搜索到的知名模拟器中，Anbox已经被作者弃坑了，Android Studio模拟器则是面向开发者，想要使用还要安装Android Studio开发环境。&lt;/p>
&lt;p>&lt;img src="https://lbqaq.top/p/redroid-maa/IMAGE/FUrYLxA.jpg"
width="680"
height="652"
srcset="https://lbqaq.top/p/redroid-maa/IMAGE/FUrYLxA_hu_c75c6775f0f9f0.jpg 480w, https://lbqaq.top/p/redroid-maa/IMAGE/FUrYLxA_hu_ba1dee1c70dac098.jpg 1024w"
loading="lazy"
alt="be like"
class="gallery-image"
data-flex-grow="104"
data-flex-basis="250px"
>&lt;/p>
&lt;p>在搜索中，我发现ReDroid可以满足我的需求。作为一个“云手机”的方案，自然是可以部署在本地，摸索明白了部署到服务器上也挺不错(雾。&lt;/p>
&lt;p>具体的安装的教程我参考的是Ivon大佬的&lt;a class="link" href="https://ivonblog.com/posts/redroid-android-docker/" target="_blank" rel="noopener"
>这篇文章&lt;/a>，在此基础上作了一些小小的修改。&lt;/p>
&lt;h2 id="redroid配置">&lt;a href="#redroid%e9%85%8d%e7%bd%ae" class="header-anchor">&lt;/a>ReDroid配置
&lt;/h2>&lt;h3 id="安装环境">&lt;a href="#%e5%ae%89%e8%a3%85%e7%8e%af%e5%a2%83" class="header-anchor">&lt;/a>安装环境
&lt;/h3>&lt;p>ReDroid需要Linux内核启用binderfs模块，Arch Liunx默认的linux内核并不包含此模块，需要安装linux-zen模块。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -S linux-zen
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里我强烈建议安装官方的&lt;a class="link" href="https://github.com/remote-android/redroid-doc/blob/master/deploy/README.md" target="_blank" rel="noopener"
>安装指南&lt;/a>来，我一开始按照Ivon大佬的教程尝试在默认的Linux内核里启用该模块，结果ReDroid一直启动不了。最后更换内核后就成功运行起来了QAQ。&lt;/p>
&lt;p>接着安装docker和docker-compose，用来运行ReDroid的容器&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo pacman -S docker docker-compose
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>还要安装ADB和Scrcpy，用于连接到安卓虚拟机&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo pacman -S android-tools
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S scrcpy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="可选配置arm转译器">&lt;a href="#%e5%8f%af%e9%80%89%e9%85%8d%e7%bd%aearm%e8%bd%ac%e8%af%91%e5%99%a8" class="header-anchor">&lt;/a>[可选]配置ARM转译器
&lt;/h3>&lt;p>大部分安卓应用都只有ARM版，这也意味着无法在X86的电脑上运行，这时就需要安装ARM转译器了。&lt;/p>
&lt;p>然而，明日方舟居然支持X86，我们可以通过压缩工具解压方舟的安装包，可以看到&lt;code>lib&lt;/code>下有&lt;code>x86&lt;/code>目录。这也意味着如果只是用来玩方舟的话，完全不需要配置ARM转译。&lt;/p>
&lt;p>同时，根据大佬的教程配置好转译器后，方舟反而会闪退，所以完全不用做此步😥。如果需要安装arm应用，可以看上面大佬的教程来做。&lt;/p>
&lt;p>我后面可能会考虑使用libhoudini来作为ReDroid的转译器。&lt;/p>
&lt;h3 id="启动镜像">&lt;a href="#%e5%90%af%e5%8a%a8%e9%95%9c%e5%83%8f" class="header-anchor">&lt;/a>启动镜像
&lt;/h3>&lt;p>我这里就使用不包含ARM转译器的ReDroid继续了。通过下面的命令即可部署ReDroid：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo docker run -itd --privileged &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/luobo/redroid:/data &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 5555:5555 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --name redroid11 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> redroid/redroid:11.0.0-latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后使用adb连接，并执行Scrcpy，显示手机画面：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">adb connect localhost:5555
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scrcpy -s localhost:5555
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>对于Google服务框架，我并不是刚需，就不安装了。如果需要安装，可以查看之前提到的教程。&lt;/p>
&lt;p>Scrcpy2.0版本，已经自带了声音模块，无需再安装额外的软件。&lt;/p>
&lt;p>如果遇到报错&lt;code>Failed to initialize audio/opus, error 0xfffffffe&lt;/code>&lt;/p>
&lt;p>只需要手动指定其他的音频解析器即可，如下面所示：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">scrcpy -s localhost:5555 --audio-codec&lt;span class="o">=&lt;/span>aac
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果不需要声音，只需要加上&lt;code>--no-audio&lt;/code>，如下面所示：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">scrcpy -s localhost:5555 --no-audio
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://lbqaq.top/p/redroid-maa/IMAGE/image-20230617164434447.png"
width="1340"
height="928"
srcset="https://lbqaq.top/p/redroid-maa/IMAGE/image-20230617164434447_hu_3d7c40e95c733123.png 480w, https://lbqaq.top/p/redroid-maa/IMAGE/image-20230617164434447_hu_8f37323fcbd91ffd.png 1024w"
loading="lazy"
alt="运行截图"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;h3 id="安装应用及开关机">&lt;a href="#%e5%ae%89%e8%a3%85%e5%ba%94%e7%94%a8%e5%8f%8a%e5%bc%80%e5%85%b3%e6%9c%ba" class="header-anchor">&lt;/a>安装应用及开关机
&lt;/h3>&lt;p>向ReDroid安装应用，只需要使用adb即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">adb -s localhost:5555 install &lt;span class="s2">&amp;#34;/mnt/data/Downloads/mrfz_2.0.11_20230605_102450_87eb5.apk&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>开关机也很简单，我们只需对docker容器进行操作。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo docker stop redroid11 &lt;span class="c1">#关机&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker start redroid11 &lt;span class="c1">#开机&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="maa配置">&lt;a href="#maa%e9%85%8d%e7%bd%ae" class="header-anchor">&lt;/a>MAA配置
&lt;/h2>&lt;p>MAA作为自动化的挂机&lt;del>长草&lt;/del>神器，肯定是要安排上的。&lt;/p>
&lt;h3 id="安装maa">&lt;a href="#%e5%ae%89%e8%a3%85maa" class="header-anchor">&lt;/a>安装MAA
&lt;/h3>&lt;p>&lt;del>Arch用户直接aur安装即可&lt;/del>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">yay -S maa-assistant-arknights
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我使用yay安装时，会安装许多用不到的库，而且会因为依赖错误而无法安装。故还是去&lt;a class="link" href="https://maa.plus/" target="_blank" rel="noopener"
>官网&lt;/a>下载压缩包解压使用。&lt;/p>
&lt;h3 id="配置maa">&lt;a href="#%e9%85%8d%e7%bd%aemaa" class="header-anchor">&lt;/a>配置MAA
&lt;/h3>&lt;p>我们需要修改&lt;code>./MAA-v{版本号}-linux-{架构}/Python/&lt;/code> 目录下的 &lt;code>sample.py&lt;/code> 文件&lt;/p>
&lt;p>首先需要配置adb连接，由于我们之前已经安装过adb了，这里直接替换地址即可：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="n">asst&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">connect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;adb&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;127.0.0.1:5555&amp;#39;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们可以执行&lt;code>python sample.py&lt;/code>，如果输出&lt;code>连接成功&lt;/code>则配置成功&lt;/p>
&lt;p>之后我们需要配置MAA的任务，这里可以参考&lt;a class="link" href="https://maa.plus/docs/3.1-%E9%9B%86%E6%88%90%E6%96%87%E6%A1%A3.html" target="_blank" rel="noopener"
>官方的文档&lt;/a>进行修改&lt;/p>
&lt;p>这里附上我的配置&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl"> &lt;span class="n">asst&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;StartUp&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">asst&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Fight&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;stage&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># 关卡名，可选，默认为空，识别当前/上次的关卡。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;report_to_penguin&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># 是否汇报企鹅数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;expiring_medicine&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">999&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># 最大使用 48 小时内过期理智药数量，可选，默认 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># &amp;#39;penguin_id&amp;#39;: &amp;#39;1234567&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">asst&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Recruit&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># 是否启用本任务，可选，默认为 true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;select&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="c1"># 会去点击标签的 Tag 等级，必选&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;confirm&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;times&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">asst&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Infrast&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;facility&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Mfg&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Trade&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Control&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Power&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Reception&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Office&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Dorm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;drones&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Money&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># 无人机用途 &amp;#34;_NotUse&amp;#34;、&amp;#34;Money&amp;#34;、&amp;#34;SyntheticJade&amp;#34;、&amp;#34;CombatRecord&amp;#34;、&amp;#34;PureGold&amp;#34;、&amp;#34;OriginStone&amp;#34;、&amp;#34;Chip&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;replenish&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># 贸易站“源石碎片”是否自动补货,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;dorm_trust_enabled&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">True&lt;/span> &lt;span class="c1"># 是否将宿舍剩余位置填入信赖未满干员&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">asst&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Visit&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">asst&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Mall&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;shopping&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;buy_first&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;招聘许可&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;龙门币&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;blacklist&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;家具&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;碳&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">asst&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Award&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置好后只需要一行命令就可以执行脚本了&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">python sample.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>至此，我们终于可以愉快的挂机了，再也不用担心体力被浪费了（雾&lt;/p>
&lt;p>由于ReDroid是基于Dokcer的，这也意味着可以将其配置到服务器上，就可以实现24小时自动挂机了。不过，要想流畅的运行方舟，最好还是有4G以上的内存，目前我的服务器还没有这么大的内存，之后有机会再尝试吧。&lt;/p></description></item></channel></rss>